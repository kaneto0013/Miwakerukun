# 段階的開発計画

## フェーズ0: 調査・設計固め（1スプリント）
- 要件の再確認、利用するYOLO/埋め込みモデル/OCRの選定とライセンス整理
- プロトタイプ運用フロー（画像取得〜フィードバック反映）のシーケンス図・データフロー図作成
- 処理性能要件を踏まえたハードウェア前提・計測指標の決定
- テスト用サンプルデータセットの準備方針確定

## フェーズ1: プロジェクト雛形構築（1スプリント）
- 指定ディレクトリ構成でプロジェクトを初期化し、必須ライブラリの依存関係定義（poetry/pip等）
- FastAPIアプリの最小起動確認（src/api.py）とベースルーティングの用意
- CI（pytest実行）およびコード整形ツール（black/isort/mypy等）の雛形セットアップ
- READMEに開発手順・環境構築手順を記載

## フェーズ2: コア画像処理・特徴抽出モジュール実装（2スプリント）
- `detect.py`: YOLO推論ラッパを実装し、検出結果（BBox+score）を返却
- `preprocess.py`: 画像前処理（刻印強調ON/OFF）を関数化
- `embed.py`: ResNet/MobileNetを用いた埋め込み取得処理とL2正規化
- `signature.py`: 色ヒストグラム・形状統計・サイズ分布・BoE生成の実装
- `ocr.py`: Tesseract/EasyOCRのON/OFF切り替え可能なAPIを用意

## フェーズ3: スコアリングと保存レイヤー整備（2スプリント）
- `match.py`: 各シグネチャ類似度と総合スコア計算（重み・閾値は設定ファイル化）
- `feedback.py`: プロトタイプ更新・FAISS追加処理の雛形実装
- `store.py`: SQLiteアクセス層・FAISS/ファイル保存のユーティリティ化
- DBマイグレーションスクリプト（初期スキーマ作成）とFAISS初期化ロジック

## フェーズ4: API統合とワークフロー実現（2スプリント）
- `/api/bags`, `/api/images`, `/api/compare`, `/api/feedback`, `/api/results` のエンドポイント実装
- 処理フロー：アップロード→検出→特徴抽出→比較→保存を一連で動作させる
- 未認識領域検出ロジックと可視化PNG生成を組み込み
- エラーハンドリングとログ出力の標準化（構造化ログ＋レスポンス設計）

## フェーズ5: UI/UX整備と履歴閲覧（2スプリント）
- `ui/views.py` とテンプレート（Jinja2/HTMX）でアップロード・比較・結果表示画面を構築
- 可視化画像のプレビュー、スコア内訳表示、未認識領域指摘をUIに反映
- フィードバック送信UIと即時反映トーストの実装
- 履歴画面（比較結果一覧・検索・再閲覧）の実装とダウンロードリンク

## フェーズ6: テスト・性能検証・チューニング（1–2スプリント）
- Pytestでユニット/統合テスト整備、E2Eテストシナリオ（正常系・異常系）追加
- サンプルデータで精度・処理時間を測定し、閾値・重み・前処理条件を調整
- ログ/モニタリング（処理時間・エラー率）を可視化し、運用時のチェックリストを整備

## フェーズ7: ドキュメント整備とリリース準備（1スプリント）
- ユーザーガイド（画像撮影方法、UI操作手順、再解析の手順）作成
- 開発者向けドキュメント（データ構造、アルゴリズム説明、再学習手順）整備
- MVPリリースノート、今後の拡張計画（動画対応、LoRA再学習等）のロードマップ化
